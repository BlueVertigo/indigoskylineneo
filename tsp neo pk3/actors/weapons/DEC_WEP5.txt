//===========================================================================
//
// The Toolbox
//
// by Marty Kirra
// Sprites by Marty Kirra
//
//===========================================================================
ACTOR Toolbox : Weapon
{
	Weapon.Kickback 1500
	Weapon.AmmoType	"ToolboxMag"
	Weapon.AmmoGive	0
	Weapon.AmmoUse	1
	Weapon.AmmoType2 "ToolboxAmmo"
	Weapon.AmmoUse2	0
	Inventory.PickupMessage "[Marston Arms RPG-2090 (The Toolbox)] [Class: Projectile Weapon, Slot 5]"
	Obituary "%k was brought closer to god thanks to %o's Toolbox."
	+Weapon.AMMO_OPTIONAL
	+WEAPON.NoAlert
   States
   {
   Ready:
      RNLG A 1 A_WeaponReady
      LOOP
   Deselect:
      RNLG A 0 A_PlaySound("toolbox/off", 6)
	  RNLU GFE 1
	  RNLU E 0 A_PlaySound("toolbox/deequip", 5)
	  RNLD ABCD 1
   DeselectLoop:
	  TNT1 A 4 A_Lower
      Loop
   Select:
      TNT1 A 5 A_PlaySound("toolbox/equip", 5)
	  RNLU ABCD 1
	  RNLU D 0 A_PlaySound("toolbox/on", 6)
	  RNLU DEFG 1
   SelectLoop:
      RNLG A 1 A_Raise
	  Loop
   Fire:
      TNT1 A 0 A_JumpIfNoAmmo("Empty")
      RNLF A 0 A_JumpIfInventory("ToolboxHeld", 4, "FireHold4") // WHAT IS THIS?!
      RNLF A 0 A_JumpIfInventory("ToolboxHeld", 3, "FireHold3") // this is some dumb shenanigans to get
      RNLF A 0 A_JumpIfInventory("ToolboxHeld", 2, "FireHold2") // the sound to not cut off when firing
      RNLF A 0 A_JumpIfInventory("ToolboxHeld", 1, "FireHold") // just hopping through channels. :P
      RNLF A 0 A_PlaySound("toolbox/prime", 5)
      RNLF ABCDE 1
	  RNLF F 2 BRIGHT A_PlaySound("toolbox/rocket", 6)
	  TNT1 A 0 A_AlertMonsters
	  RNLF G 2 BRIGHT
	  RNLF HIJKLE 1
	  RNLF E 0 A_GiveInventory("ToolboxHeld", 1)
	  RNLF E 5 A_WeaponReady
	  Goto FireEnd
   FireHold:
      RNLF E 7
	  RNLF F 2 BRIGHT A_PlaySound("toolbox/rocket", 5)
	  TNT1 A 0 A_AlertMonsters
	  RNLF G 2 BRIGHT
	  RNLF HIJKLE 1
	  RNLF E 0 A_GiveInventory("ToolboxHeld", 1)
      RNLF E 1 A_WeaponReady
	  Goto FireEnd
   FireHold2:
      RNLF E 7
	  RNLF F 2 BRIGHT A_PlaySound("toolbox/rocket", 6)
	  TNT1 A 0 A_AlertMonsters
	  RNLF G 2 BRIGHT
	  RNLF HIJKLE 1
	  RNLF E 0 A_GiveInventory("ToolboxHeld", 1)
      RNLF E 1 A_WeaponReady
	  Goto FireEnd
   FireHold3:
      RNLF E 7
	  RNLF F 2 BRIGHT A_PlaySound("toolbox/rocket", 5)
	  TNT1 A 0 A_AlertMonsters
	  RNLF G 2 BRIGHT
	  RNLF HIJKLE 1
	  RNLF E 0 A_GiveInventory("ToolboxHeld", 1)
      RNLF E 1 A_WeaponReady
	  Goto FireEnd
   FireHold4:
      RNLF E 7
	  RNLF F 2 BRIGHT A_PlaySound("toolbox/rocket", 6)
	  TNT1 A 0 A_AlertMonsters
	  RNLF G 2 BRIGHT
	  RNLF HIJKLE 1
      RNLF E 1 A_WeaponReady
	  Goto FireEnd
   FireEnd:
      RNLF A 0 A_TakeInventory("ToolboxHeld", 99)
      RNLF EDCBA 1
	  RNLG A 3
	  Goto Ready
    Empty:
	  RNLU A 0 A_PlaySound("toolbox/empty")
	  RNLU E 1
	  RNLE A 2
	  RNLU E 2
	  RNLE A 2
	  RNLU EFG 1
	  RNLG A 1
	  Goto Ready
	   
	     }
}

ACTOR ToolboxHeld : Inventory
{
	Inventory.MaxAmount 5
}


ACTOR ToolboxMag : Ammo
{
	+IGNORESKILL
	Inventory.MaxAmount 5
}

ACTOR ToolboxAmmo : Ammo Replaces RocketAmmo
{
	+IGNORESKILL
	Inventory.Amount 1
	Inventory.MaxAmount 30
	Ammo.BackpackAmount 5
	Ammo.BackpackMaxAmount 60
	Ammo.DropAmount 1
	Inventory.Icon "919AA0"
	Inventory.PickupMessage "Picked up a Toolbox Rocket. [+1 Toolbox Ammo]"
	Inventory.PickupSound "919m/magout"
	States
	{
	Spawn:
		919A A -1
		Stop
	}
}

ACTOR ToolboxPickup : CustomInventory Replaces RocketLauncher
{
    Inventory.PickupMessage "[Marston Arms RPG-2090 (The Toolbox)] [Class: Projectile Weapon, Slot 5]"
	+INVENTORY.AUTOACTIVATE
	States
	{
	Spawn:
      919P A -1
	  Stop
	Pickup:
	  TNT1 A 0 A_JumpIfInventory("Toolbox", 1, "AmmoCheck")
	  TNT1 A 0 A_GiveInventory("Toolbox", 1)
	  TNT1 A 0 A_GiveInventory("ToolboxAmmo", 10)
	  TNT1 A 1 ACS_ExecuteAlways(862)
	  Stop
	AmmoCheck:
      TNT1 A 0 A_JumpIfInventory("ToolboxAmmo", 0, "PickupFail")
	  TNT1 A 0 A_GiveInventory("ToolBoxAmmo", 10)
	  Stop
	PickupFail:
      919P A 1
      Fail
	}
}