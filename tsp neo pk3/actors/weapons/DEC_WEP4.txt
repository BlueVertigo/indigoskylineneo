//===========================================================================
//
// Kurdd & Schaumers AB-50
//
// by Marty Kirra
// Sprites by Mike12, zrrion the insect, and Marty Kirra
//
//===========================================================================
ACTOR AmmoBox50 : Weapon Replaces Chaingun 
{
	Weapon.Kickback 100
	Weapon.AmmoType	"AmmoBoxMag"
	Weapon.AmmoGive	0
	Weapon.AmmoUse	1
	Weapon.AmmoType2 "AmmoBoxAmmo"
	Weapon.AmmoGive2 50
	Weapon.AmmoUse2	0
	Inventory.PickupMessage "[Kurdd & Schaumers AB-50] [Class: Sub-Machine Gun, Slot 4]"
	Decal BulletChip
	Obituary "%o was riddled with bullets thanks to %k's AB-50."
	+Weapon.AMMO_OPTIONAL
	+NOEXTREMEDEATH
	+WEAPON.NoAlert
   States
   {
   Spawn:
	  ABXP A -1
	  Stop
   Ready:
      ABXG A 1 A_WeaponReady
	  TNT1 A 0 A_JumpIfInventory("Reloading",1,"Reload")
      LOOP
   Deselect:
      TNT1 A 0 A_PlaySound("AmmoBox/Down", 5)
	  ABXD ABCDE 1
	  TNT1 A 6
   DeselectLoop:
	  TNT1 A 1 A_Lower
	  Loop
   Select:
      TNT1 A 0 A_PlaySound("AmmoBox/Up", 5)
      TNT1 A 4
	  ABXU ABCDE 1
   SelectLoop:
	  ABXG A 1 A_Raise
      Loop
   Fire:
	  TNT1 A 0 A_JumpIfNoAmmo("AutoEmpty")
	  ABXG A 0 BRIGHT
      ABXG A 0 A_GunFlash
	  ABXG A 0 A_AlertMonsters
	  ABXG A 0 A_SetPitch(pitch - .3)
	  ABXG A 0 A_SetAngle(angle + (random(-0.2,0.2)))
      ABXG A 0 A_PlayWeaponSound("AmmoBox/fire")
    Fire0:
      ASTF A 0 BRIGHT A_FireBullets(6,1,-1,7,"BulletPuff",1)
	  ASTF A 0 A_Jump(64,"AFire4")
      ASTF A 0 A_Jump(64,"AFire3")
	  ASTF A 0 A_Jump(88,"Afire2")
	AFire1:
	  ASTF B 0 A_FireCustomMissile("9mmCasingSpawner",-4,0,0,0)
	  ASTF B 0 A_Light2
      ABXF A 1 BRIGHT A_Light1
	  ASTF B 0 A_Light0
      Goto FireEnd
	AFire2:
	  ASTF B 0 A_FireCustomMissile("9mmCasingSpawner",-3,0,0,0)
	  ASTF C 0 A_Light2
      ABXF B 1 BRIGHT A_Light1
	  ASTF C 0 A_Light0
      Goto FireEnd
	AFire3:
	  ASTF B 0 A_FireCustomMissile("9mmCasingSpawner",-5,0,0,0)
	  ASTF D 0 A_Light2
      ABXF C 1 BRIGHT A_Light1
	  ASTF D 0 A_Light0
	  Goto FireEnd
	AFire4:
	  ASTF B 0 A_FireCustomMissile("9mmCasingSpawner",-5,0,0,0)
	  ASTF D 0 A_Light2
      ABXF D 1 BRIGHT A_Light1
	  ASTF D 0 A_Light0
	FireEnd:
	  ABXF E 1
	  ABXF F 1
	  ABXF G 2 A_Refire
	  ABXF FE 1 
	  ABXG A 1
	  Goto Ready
	AutoEmpty:
	  ABXG A 5 A_PlaySound("919m/dry",5)
	  Goto Reload 
	Reload:
	  ABXG A 0 A_JumpIfInventory("AmmoBoxMag", 50, "2")
	  ABXG A 0 A_JumpIfInventory("AmmoBoxAmmo", 1, "2")
	  ABXG A 1 A_WeaponReady
	  Goto Ready
	ReloadStart:
	  ABXG A 5 
	  ABXR AUBC 1
	  ABXG A 0 A_FireCustomMissile("SpentClip1",3,0,5,0)
	  ABXR D 1 A_PlaySound("AmmoBox/Out",6)
	  ABXR EFGHIIIIIIIIIIIIIIIIIIIIIIIIIII 1
	  ABXR J 1 A_PlaySound("AmmoBox/In",6)
	  ABXR KLMNOP 1 
	ReloadWork:
	  MPTR I 0 A_TakeInventory("AmmoBoxAmmo",1)
	  MPTR I 0 A_GiveInventory("AmmoBoxMag",1)
	  MPTR I 0 A_JumpIfInventory("AmmoBoxMag",50,"ReloadFinish")
	  MPTR I 0 A_JumpifInventory("AmmoBoxAmmo",1,"ReloadWork")
	ReloadFinish:
	  ABXR PSTCBUA 1
	  ABXG A 4
	  Goto Ready
   }
}

ACTOR AmmoBoxMag : Ammo
{
	+IGNORESKILL
	Inventory.MaxAmount 50
}

ACTOR AmmoBoxAmmo : Ammo
{
	Inventory.Amount 25
	Inventory.MaxAmount 150
	Ammo.BackpackAmount 50
	Ammo.BackpackMaxAmount 300
	Inventory.Icon "ABXAA0"
	Inventory.PickupMessage "Picked up machine gun ammo. [+25 SMG Ammo]"
	Inventory.PickupSound "AmmoBox/In"
	States
	{
	Spawn:
		ABXA A -1
		Stop
	}
}

ACTOR BulletBoxAmmoSpawner replaces ClipBox
{
	States
	{
	Spawn:
		TNT1 A 0
		TNT1 A 0 A_SpawnItem("AmmoBoxAmmo", 1,0)
		TNT1 A 0 A_SpawnItem("TSPPistolAmmo", 1,0)
		TNT1 A 0 A_SpawnItem("TSPPistolAmmo", 1,0)
		Stop
	}
}

ACTOR AmmoBox50DroppedPickup : CustomInventory
{
    Inventory.PickupMessage "[Kurdd & Schaumers AB-50] [Class: Sub-Machine Gun, Slot 4]"
	+INVENTORY.AUTOACTIVATE
	States
	{
	Spawn:
      ABXP A -1
	  Stop
	Pickup:
	  TNT1 A 0 A_JumpIfInventory("AmmoBox50", 1, "AmmoCheck")
	  TNT1 A 0 A_GiveInventory("FlavorPickupAmmoBox50", 1)
	  TNT1 A 0 A_GiveInventory("AmmoBox50", 1)
	  TNT1 A 0 A_GiveInventory("AmmoBoxAmmo", 25)
	  Stop
	AmmoCheck:
      TNT1 A 0 A_JumpIfInventory("AmmoBoxAmmo", 0, "PickupFail")
	  TNT1 A 0 A_GiveInventory("AmmoBoxAmmo", 25)
	  Stop
	PickupFail:
      ABXP A 1
      Fail
	}
}